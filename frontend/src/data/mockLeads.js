const HIGH_VALUE_THRESHOLD = 1000000

const rawLeads = [
  {
    EnquiryID: 'E2404AKA00081',
    EnquiryDate: '2024-04-02',
    CloseDate: '2024-04-18',
    LeadStage: 'Closed-Won',
    LeadStatus: 'Closed',
    Dealer: 'Akash Vintrade Pvt. Ltd.',
    State: 'Bihar',
    City: 'Patna',
    Segment: 'Rental',
    KVA: 30,
    KVARange: '0-50',
    Owner: 'Ankur Bhagat',
    Source: 'Inbound',
    OrderValue: 4500000,
    LossReason: '',
    FollowupCount: 1,
    NextFollowupDate: null,
    Remarks: 'Deal closed successfully',
    FY: 'FY24',
    Month: 'Apr',
    Week: 'W2',
    CreatedBy: 'ankur.bhagat',
    UpdatedAt: '2024-04-19T10:11:00Z',
  },
  {
    EnquiryID: 'E2404RRA00190',
    EnquiryDate: '2024-04-10',
    CloseDate: null,
    LeadStage: 'Prospecting',
    LeadStatus: 'Open',
    Dealer: 'Raj Automobiles',
    State: 'Bihar',
    City: 'Gaya',
    Segment: 'Real Estate',
    KVA: 82.5,
    KVARange: '50-100',
    Owner: 'Rahul Kumar',
    Source: 'Expo Booth',
    OrderValue: 7200000,
    LossReason: '',
    FollowupCount: 2,
    NextFollowupDate: '2024-05-05',
    Remarks: 'Customer wants 30 and 80 kva genset',
    FY: 'FY24',
    Month: 'Apr',
    Week: 'W3',
    CreatedBy: 'rahul.kumar',
    UpdatedAt: '2024-04-26T05:54:00Z',
  },
  {
    EnquiryID: 'E2404GEB00002',
    EnquiryDate: '2024-03-18',
    CloseDate: '2024-04-05',
    LeadStage: 'Order Booked',
    LeadStatus: 'Closed',
    Dealer: 'SKS Enterprises',
    State: 'Bihar',
    City: 'Bhagalpur',
    Segment: 'Government And Tenders',
    KVA: 10,
    KVARange: '0-50',
    Owner: 'Santosh Sinha',
    Source: 'Tender Portal',
    OrderValue: 1250000,
    LossReason: '',
    FollowupCount: 1,
    NextFollowupDate: null,
    Remarks: 'PO received, processing order',
    FY: 'FY24',
    Month: 'Mar',
    Week: 'W4',
    CreatedBy: 'santosh.sinha',
    UpdatedAt: '2024-04-05T11:03:00Z',
  },
  {
    EnquiryID: 'E2404PSS00045',
    EnquiryDate: '2024-02-12',
    CloseDate: '2024-03-20',
    LeadStage: 'Closed-Lost',
    LeadStatus: 'Closed',
    Dealer: 'PSS Equipment',
    State: 'Jharkhand',
    City: 'Ranchi',
    Segment: 'Rental',
    KVA: 125,
    KVARange: '100-200',
    Owner: 'Anand Sharma',
    Source: 'Referral',
    OrderValue: 9800000,
    LossReason: 'Lost to competitor pricing',
    FollowupCount: 3,
    NextFollowupDate: null,
    Remarks: 'Lost to competitor pricing',
    FY: 'FY24',
    Month: 'Mar',
    Week: 'W3',
    CreatedBy: 'anand.sharma',
    UpdatedAt: '2024-03-21T08:16:00Z',
  },
  {
    EnquiryID: 'E2404JBE00067',
    EnquiryDate: '2024-04-20',
    CloseDate: null,
    LeadStage: 'Prospecting',
    LeadStatus: 'Open',
    Dealer: 'J.B Enterprises',
    State: 'Bihar',
    City: 'Muzaffarpur',
    Segment: 'Manufacturing',
    KVA: 250,
    KVARange: '200+',
    Owner: 'Vaibhav Singh',
    Source: 'Website',
    OrderValue: 13400000,
    LossReason: '',
    FollowupCount: 2,
    NextFollowupDate: '2024-05-02',
    Remarks: 'Scheduled site visit next week',
    FY: 'FY24',
    Month: 'Apr',
    Week: 'W4',
    CreatedBy: 'vaibhav.singh',
    UpdatedAt: '2024-04-28T14:31:00Z',
  },
  {
    EnquiryID: 'E2403DEL00088',
    EnquiryDate: '2024-03-05',
    CloseDate: '2024-04-12',
    LeadStage: 'Won',
    LeadStatus: 'Closed',
    Dealer: 'Delta Power',
    State: 'Delhi',
    City: 'New Delhi',
    Segment: 'IT & Data Center',
    KVA: 60,
    KVARange: '50-100',
    Owner: 'Swati Sharma',
    Source: 'Partner',
    OrderValue: 5600000,
    LossReason: '',
    FollowupCount: 4,
    NextFollowupDate: null,
    Remarks: 'High urgency deployment',
    FY: 'FY24',
    Month: 'Apr',
    Week: 'W2',
    CreatedBy: 'swati.sharma',
    UpdatedAt: '2024-04-12T09:44:00Z',
  },
  {
    EnquiryID: 'E2403KOL00031',
    EnquiryDate: '2024-03-22',
    CloseDate: null,
    LeadStage: 'Qualified',
    LeadStatus: 'Open',
    Dealer: 'Eastern Motors',
    State: 'West Bengal',
    City: 'Kolkata',
    Segment: 'Hospitality',
    KVA: 90,
    KVARange: '50-100',
    Owner: 'Ritika Bose',
    Source: 'Webinar',
    OrderValue: 4800000,
    LossReason: '',
    FollowupCount: 1,
    NextFollowupDate: '2024-05-01',
    Remarks: 'Need financing support',
    FY: 'FY24',
    Month: 'Apr',
    Week: 'W1',
    CreatedBy: 'ritika.bose',
    UpdatedAt: '2024-04-25T07:20:00Z',
  },
  {
    EnquiryID: 'E2402MUM00076',
    EnquiryDate: '2024-02-28',
    CloseDate: null,
    LeadStage: 'Qualified',
    LeadStatus: 'Open',
    Dealer: 'Mumbai Power Corp',
    State: 'Maharashtra',
    City: 'Mumbai',
    Segment: 'Commercial',
    KVA: 180,
    KVARange: '100-200',
    Owner: 'Gaurav Desai',
    Source: 'LinkedIn',
    OrderValue: 10200000,
    LossReason: '',
    FollowupCount: 5,
    NextFollowupDate: '2024-05-03',
    Remarks: 'Negotiating payment milestones',
    FY: 'FY24',
    Month: 'Mar',
    Week: 'W4',
    CreatedBy: 'gaurav.desai',
    UpdatedAt: '2024-04-29T13:18:00Z',
  },
  {
    EnquiryID: 'E2402CHE00014',
    EnquiryDate: '2024-02-10',
    CloseDate: '2024-03-15',
    LeadStage: 'Lost',
    LeadStatus: 'Closed',
    Dealer: 'South Power Systems',
    State: 'Tamil Nadu',
    City: 'Chennai',
    Segment: 'Manufacturing',
    KVA: 75,
    KVARange: '50-100',
    Owner: 'Priya Raman',
    Source: 'Cold Call',
    OrderValue: 4200000,
    LossReason: 'Budget constraints',
    FollowupCount: 3,
    NextFollowupDate: null,
    Remarks: 'Prospect will revisit in Q3',
    FY: 'FY24',
    Month: 'Mar',
    Week: 'W2',
    CreatedBy: 'priya.raman',
    UpdatedAt: '2024-03-16T16:09:00Z',
  },
  {
    EnquiryID: 'E2404HYD00055',
    EnquiryDate: '2024-04-08',
    CloseDate: null,
    LeadStage: 'New',
    LeadStatus: 'Open',
    Dealer: 'Hyderabad Electro',
    State: 'Telangana',
    City: 'Hyderabad',
    Segment: 'Healthcare',
    KVA: 40,
    KVARange: '0-50',
    Owner: 'Nidhi Rao',
    Source: 'Campaign',
    OrderValue: 3600000,
    LossReason: '',
    FollowupCount: 0,
    NextFollowupDate: '2024-05-06',
    Remarks: 'Demo scheduled',
    FY: 'FY24',
    Month: 'Apr',
    Week: 'W2',
    CreatedBy: 'nidhi.rao',
    UpdatedAt: '2024-04-28T12:12:00Z',
  },
]

const daysBetween = (start, end) => {
  if (!start || !end) return null
  return Math.max(0, Math.round((new Date(end) - new Date(start)) / (1000 * 60 * 60 * 24)))
}

const today = new Date('2024-05-01')

export const fallbackLeads = rawLeads.map((lead) => {
  const leadAgeDays =
    lead.LeadStatus === 'Open' && lead.EnquiryDate ? daysBetween(lead.EnquiryDate, today) : null

  const closeTimeDays =
    lead.CloseDate && lead.EnquiryDate ? daysBetween(lead.EnquiryDate, lead.CloseDate) : null

  const isHighValue = lead.OrderValue >= HIGH_VALUE_THRESHOLD

  const winFlag =
    lead.LeadStage?.toLowerCase().includes('won') || lead.LeadStage === 'Won' ? 1 : 0

  return {
    enquiry_id: lead.EnquiryID,
    enquiry_date: lead.EnquiryDate,
    close_date: lead.CloseDate,
    lead_stage: lead.LeadStage,
    lead_status: lead.LeadStatus,
    dealer: lead.Dealer,
    state: lead.State,
    city: lead.City,
    segment: lead.Segment,
    kva: lead.KVA,
    kva_range: lead.KVARange,
    owner: lead.Owner,
    source: lead.Source,
    order_value: lead.OrderValue,
    loss_reason: lead.LossReason,
    followup_count: lead.FollowupCount,
    next_followup_date: lead.NextFollowupDate,
    remarks: lead.Remarks,
    fy: lead.FY,
    month: lead.Month,
    week: lead.Week,
    created_by: lead.CreatedBy,
    updated_at: lead.UpdatedAt,
    lead_age_days: leadAgeDays,
    close_time_days: closeTimeDays,
    is_high_value: isHighValue,
    win_flag: Boolean(winFlag),
  }
})

export { HIGH_VALUE_THRESHOLD }